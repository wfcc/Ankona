- content_for :scripts do
  = javascript_include_tag 'diagram_edit'

  -# this loads codes for fairy pieces into a js object
  %script
    ! ik.pieces = #{@pieces}
    
- content_for :title do
  - if @diagram.stipulation.present?
    = @diagram.stipulation
    by
    = @diagram.authors.map(&:name).commatize
  - else
    new problem

.prepend-12
  %button#change-view.button
    Change to solving view
    
%h2 Editing problem #{@diagram.id}
= semantic_form_for @diagram do |f|

  = f.hidden_field :id
  #first.span-12
    .label Position (w/b)                                                          
    = f.input :white, label: false
    .fine  ↕ FIDE piece notation (KDTLSP), popeye notation for fairy pieces
    = f.input :black, label: false
    %p.clear
      %button{id: :fen_button}
        FEN ▼
      %button{id: :fairy_button}
        Fairy stuff ▼
      #fen-block(style = "display:none")
        = f.input :position, label: :FEN,  hint: 'KQRBNP notation for FEN'
      #fairy-block(style = "display:none")
        .label Chameleon pieces
        white:
        = text_field_tag :white_c, ''
        %br
        black:
        = text_field_tag :black_c, ''

    .cassete
      -%w{k q r b n p}.each do |figurine|
        = image_tag fig_glyph('b', figurine), 'data-id' =>  figurine, class: 'todrag'
    #divBlank= image_tag '/fen', id: 'blank'
    .cassete
      -%w{k q r b n p}.each do |figurine|
        = image_tag fig_glyph('w', figurine), 'data-id' =>  figurine.upcase, class: 'todrag'
    #pcount

    - %w{◁ ▽ △ ▷ ↻ ↺ ↕}.each do |direction|
      %button{type: "button", class: %w[moveboard button], 'data-name' => direction}
        = direction

    = f.input :stipulation, :input_html => {:class => 'c30p'}, :hint => '#2 | s#3 | h#2.5 | win | …'
    = f.input :twin, :hint => 'b) Se5->e6 | b) -Th3, c) Lh8<->La2 | 2.1;1.1 | …'
    -#= f.label 'Computer tested'
    -#= f.select :tested, Status.where{table == :diagrams}.collect {|i| [i.name, i.value] }

    = f.submit ' Save and exit ', class: :button
    - if @diagram.id.present?
      = link_to  ' Revert ', edit_diagram_path(@diagram), class: [:button, :clearboth]
  #catalog.span-12.last
    .label Authors
    #authors
      = hidden_field_tag :authors_json, @authors_json
      = text_field_tag :authors_ids, '', style: 'width:30em'
    %table.zero
      %tr
        %td= f.input :source, input_html: {size: 28}, hint: 'Printed or online publication, or tournament'
        %td= f.input :issue, input_html: {size: 10}, hint: 'Month or number, if periodical'
      %tr
        %td= f.input :label, hint: 'Problem number, or label, as given in the source', input_html: {size: 10}, label: 'Problem ID'
        %td= f.input :award, input_html: {size: 20}, hint: 'use "Prize", "HM", "Commendation"', label: 'Distinction'
    = f.input :solution, input_html: {rows: 20, cols: 5}, hint: 'Please adhere to FIDE piece notation: KDTLS.'

  #solving.span-12.last
    = f.submit ' Solve with popeye ', id: :solve, class: [:button]
    %fieldset
      %legend
      %label(for = "pyopts" class = "modest") Popeye “options” line
      = text_field_tag :pyopts, "", :class => "c30p"
      %span.fine try, setplay, duplex, maxsolutions, intelligent, …   
      #solution<>
        %span.fine Popeye solution will go here (first run may be slow)

  .clear.em1

